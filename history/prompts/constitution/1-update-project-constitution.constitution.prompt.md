---
id: 1
title: update-project-constitution
stage: constitution
date_iso: 2026-01-07
surface: agent
model: Claude Sonnet 4.5
feature: none
branch: master
user: user
command: sp.constitution
labels: ["constitution", "update", "governance"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files_yaml:
  - ".specify/memory/constitution.md"
tests_yaml: []
---

# Prompt History Record: Update Project Constitution

## Original Prompt
```
/sp.constitution

Project: Phase II – Full-Stack Multi-User Todo Web Application (Hackathon II)

Version: 2.0.0

Core Principles
- Strict Spec-Driven Development: Zero manual coding allowed. All implementation must be generated by Claude Code based on refined specifications.
- AI as Primary Developer: Claude Code is the sole code author. Human role is architect — refine specs until output is correct.
- Mandatory Traceability: Every code file must reference its originating Task ID and Spec section via comments.
- User Privacy & Isolation (Non-Negotiable): All data and operations must be strictly scoped to the authenticated user. No cross-user access ever.
- Evolutionary Consistency: Phase II extends and transforms Phase I functionality into a secure, persistent, multi-user web application.
- Security First: Stateless JWT authentication, shared secret, input validation, and protection against common vulnerabilities.

Technology Governance

Frontend (Next.js 16+)
- MUST use App Router exclusively (Pages Router forbidden)
- Server Components by default
- Client Components only where interactivity requires ('use client' directive)
- TypeScript in strict mode
- Tailwind CSS exclusively (no inline styles, no CSS modules, no other frameworks)
- Better Auth with JWT plugin enabled
- Type-safe API client in /lib/api.ts that automatically attaches JWT from Better Auth session

Backend (FastAPI + SQLModel)
- Python 3.13+
- FastAPI as the web framework
- SQLModel as exclusive ORM (no raw SQLAlchemy or SQL strings)
- Pydantic v2 for all request/response validation
- UV as package manager
- Neon Serverless PostgreSQL as database (connection via DATABASE_URL)

Authentication & Authorization (CRITICAL)
- Better Auth on frontend for signup/login
- JWT tokens issued on login (claim "sub" contains user ID)
- Shared secret via BETTER_AUTH_SECRET environment variable (identical value in frontend and backend)
- Token expiration: 7 days
- Password hashing with bcrypt (handled by Better Auth)
- Backend JWT middleware validates token on every protected request and injects user_id into request.state
- All API routes under /api/ (user_id NOT in path — extracted from JWT)
- Strict ownership enforcement: every database query MUST filter by authenticated user_id
- Unauthorized → 401, ownership mismatch → 404 (never reveal resource existence)

Security Requirements
- User Data Isolation: ALL task operations must filter by authenticated user_id
- JWT validation on every protected endpoint
- No user can access, modify, or infer existence of another user's data
- SQL injection prevention via SQLModel parameterized queries
- Input validation and sanitization on both frontend and backend

Repository Structure (Monorepo)
full-stack-web-application-todo-app/
├── .specify/                          ← Spec-Kit Plus structure
│   └── memory/
│       └── constitution.md
├── .spec-kit/
│   └── config.yaml
├── history/
│   └── prompts/
├── specs/                             ← All specifications
│   ├── overview.md
│   ├── features/
│   │   ├── task-crud-web.md
│   │   ├── authentication.md
│   │   ├── task-basic.md
│   │   ├── task-intermediate.md
│   │   └── task-advanced.md
│   ├── api/
│   │   └── rest-endpoints.md
│   ├── database/
│   │   └── schema.md
│   └── ui/
│       ├── components.md
│       └── pages.md
├── frontend/                          ← Next.js 16+ App Router
│   ├── app/
│   ├── components/
│   ├── lib/
│   └── CLAUDE.md
├── backend/                           ← FastAPI + SQLModel
│   ├── src/
│   │   ├── main.py
│   │   ├── models.py
│   │   ├── routes/
│   │   ├── db.py
│   │   └── CLAUDE.md
│   ├── tests/
│   └── requirements.txt
├── CLAUDE.md                          ← Root instructions
├── README.md
└── pyproject.toml

Domain Model Extensions (Additive to Phase I)
Task model must include:
- user_id: str (foreign key to users table, indexed)
- created_at, updated_at: datetime (UTC)
- priority: str | None ("high" | "medium" | "low")
- tags: list[str] (JSON or array column)
- due_date: datetime | None (UTC)
- is_recurring: bool = False
- recurrence_rule: str | None (simple values: "daily", "weekly", "monthly")

API-First Principles
- All API contracts defined in specs/api/rest-endpoints.md before implementation
- Backend implements endpoints first
- Frontend consumes via type-safe client
- OpenAPI/Swagger documentation auto-generated and accessible

Feature Scope for Phase II
- Full Basic Level: CRUD + completion toggle
- Full Intermediate Level: priorities, tags, search, filter (status, priority, tag, due range), sort (multiple fields)
- Full Advanced Level: due dates with picker, recurring tasks (basic rule support), browser notifications for due tasks

Success Criteria
- Secure multi-user authentication with Better Auth + JWT
- Complete implementation of Basic + Intermediate + Advanced features
- Strict user data isolation verified
- Tasks persisted in Neon PostgreSQL
- Responsive, intuitive UI with filters, sorting, modals, date picker
- All code generated by Claude Code with full traceability to specs
- Deployable: frontend on Vercel, backend on any host with DATABASE_URL
- Repository matches specified monorepo structure with layered CLAUDE.md files
```

## Response Summary
Updated the project constitution file at `.specify/memory/constitution.md` with all the specified project details, including core principles, technology governance, security requirements, repository structure, and feature scope for the Phase II Full-Stack Multi-User Todo Web Application. The constitution now reflects version 2.0.0 with all required principles and guidelines properly documented.

## Outcome
The constitution file has been successfully updated with all the required project specifications, replacing the template placeholders with actual project requirements. The file now serves as the authoritative governance document for the todo web application project.